npc_behavior_state .wandering_short:
{
	on_route<thalvaron_default_patrol>: thalvaron_default_patrol
	behavior: wandering
	max_range: 1
}

npc_behavior_state .passive:
{
	on_route<thalvaron_default_patrol>: thalvaron_default_patrol
	behavior: do_nothing
}

loot_table .default_humanoid: 
{
	slots:
	[	
		!WORLD_DROPS {}
		!WORLD_DROPS_CLOTH{}
	]	
}

loot_table .default_beast: 
{
	slots:
	[	
		!WORLD_DROPS {}
	]	
}

##########################################################################################
# North kobolds 

map_entity_spawn thalvaron_north_kobold: 
{ 
	entity thalvaron_north_kobold_a: { init_state: default } 
	entity thalvaron_north_kobold_b: { init_state: default } 
}

# Kobolds in the iceveil pass mine
{
	${
		_level: 12
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short
		_loot_table: .default_humanoid
	}

	entity thalvaron_north_kobold_a: !NPC { _string: "Iceveil Kobold" _sprite: kobold_1 _sprite_dead: kobold_1_dead }
	entity thalvaron_north_kobold_b: !NPC { _string: "Iceveil Kobold" _sprite: kobold_2 _sprite_dead: kobold_2_dead }
}

##########################################################################################
# Rebels

map_entity_spawn thalvaron_north_rebel: 
{ 
	entity thalvaron_north_rebel_a: { init_state: default } 
	entity thalvaron_north_rebel_b: { init_state: default } 
	entity thalvaron_north_rebel_c: { init_state: default } 
	entity thalvaron_north_rebel_d: { init_state: default } 
}

# Rebels around the north
{
	loot_table .north_rebel: 
	{
		slots:
		[	
			{ 
				possibility: { loot_group: .tyron_frostmane_1_quest_item requirement self<must_have_active_quest>: { id: .tyron_frostmane_1 } } 
			}

			{ 
				possibility: { loot_group: .tyron_frostmane_1_quest_item requirement self<must_have_active_quest>: { id: .tyron_frostmane_1 } } 
			}
			
			!WORLD_DROPS {}
			!WORLD_DROPS_CLOTH{}
		]	
	}
	
	${
		_level: 12
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .passive
		_loot_table: .north_rebel
	}

	entity thalvaron_north_rebel_a: !NPC { _string: "Highland Rebel" _sprite: rebel_1 _sprite_dead: rebel_1_dead }
	entity thalvaron_north_rebel_b: !NPC { _string: "Highland Rebel" _sprite: rebel_2 _sprite_dead: rebel_2_dead }
	entity thalvaron_north_rebel_c: !NPC { _string: "Highland Rebel" _sprite: rebel_3 _sprite_dead: rebel_3_dead }
	entity thalvaron_north_rebel_d: !NPC { _string: "Highland Scout" _sprite: rebel_4 _sprite_dead: rebel_4_dead _abilities: [ { id: npc_shoot }{ id: npc_attack } ] }
}

##########################################################################################
# Iceveil monsters

map_entity_spawn thalvaron_north_yeti: 
{ 
	entity thalvaron_north_yeti: { init_state: default } 
}

map_entity_spawn thalvaron_north_yeti_cave: 
{ 
	entity thalvaron_north_yeti_cave: { init_state: default } 
}

map_entity_spawn thalvaron_north_yeti_boss: 
{ 
	entity thalvaron_north_yeti_boss: { init_state: default } 
}

map_entity_spawn thalvaron_wandering_owlbear: 
{ 
	entity thalvaron_wandering_owlbear: { init_state: default } 
}

map_entity_spawn thalvaron_iceveil_wolf: 
{ 
	entity thalvaron_iceveil_wolf: { init_state: default } 
}

map_entity_spawn thalvaron_frost_troll:
{ 
	entity thalvaron_frost_troll: { init_state: default } 
}

map_entity_spawn thalvaron_rock_elemental:
{ 
	entity thalvaron_rock_elemental: { init_state: default } 
}

# Yetis in northern part of the highlands
{
	loot_table .north_yeti: 
	{
		slots:
		[	
			{ 
				possibility: { }
				possibility: { loot_group: .ronja_frostmane_1_quest_item requirement self<must_have_active_quest>: { id: .ronja_frostmane_1 } } 
			}
			
			!WORLD_DROPS {}
		]	
	}
	
	loot_table .north_yeti_2: 
	{
		slots:
		[	
			{ 
				possibility: { }
				possibility: { loot_group: .ronja_frostmane_2_quest_item requirement self<must_have_active_quest>: { id: .ronja_frostmane_2 } } 
			}
			
			!WORLD_DROPS {}
		]	
	}
		
	${
		_level: 13
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short				
		_aggro_requirements: { requirement target<must_not_have_aura>: .nook_morrow_1_quest_item }
	}

	entity thalvaron_north_yeti: !NPC { _string: "Iceveil Yeti" _sprite: yeti_1 _sprite_dead: yeti_1_dead _loot_table: .north_yeti _weapon_damage: 1.3 _resource_health: 1.3 }
	entity thalvaron_north_yeti_cave: !NPC { _string: "Cave Yeti" _sprite: yeti_2 _sprite_dead: yeti_2_dead _loot_table: .north_yeti_2 _weapon_damage: 1.4 _resource_health: 1.4 _abilities: [ { id: npc_rend } { id: npc_attack } ] }
}

# Northern yeti patriarch
{
	loot_table .north_yeti_boss: 
	{
		slots:
		[	
			{ 
				possibility: { loot_group: .north_yeti_boss } 
			}
			
			!WORLD_DROPS {}
		]	
	}
	
	loot_group .north_yeti_boss: { }
	
	ability .north_yeti_boss:	
	{
		string: "Strange Yeti Effigy"
		description: "This item starts a quest."
		flags: [ target_self item ]
		icon: icon_effigy
		direct_effect simple<start_quest>: .north_yeti_boss
		states: [ default in_combat ]
		requirement self<must_not_have_completed_quest>: { id: .north_yeti_boss }
		requirement self<must_not_have_active_quest>: { id: .north_yeti_boss }
	}

	item .north_yeti_boss:
	{
		loot_groups: [ .north_yeti_boss ]		
		string: "Strange Yeti Effigy" 
		icon: icon_effigy
		item_level: 13
		flags: [ unique not_sellable ]
		use_ability: .north_yeti_boss
	}	
			
	quest .north_yeti_boss:
	{
		string: "Strange Yeti Effigy"

		text:
		[
			"Bring the strange yeti effigy back to Ronja Frostmane."
		]
		
		description: 
		[
			"The yeti patriarch carried a strange effigy. Take it back to Ronja Frostmane, maybe she will find it interesting."
		]
		
		completion:
		[
			"Hmm, why would a stupid beast carried that ugly thing around? I don't know, maybe it found it somewhere and picked it up?"
		]

		level: 13
		quest_items: [ .north_yeti_boss ]
		next_quest: .ronja_frostmane_3
		reward_xp_multiplier: 0.2
	}

	${
		_level: 13
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .passive
		_loot_table: .north_yeti_boss 
		_weapon_damage: 1.5
		_resource_health: 1.5
		_abilities: [ { id: npc_rend } { id: npc_attack } ] 
		_aggro_requirements: { requirement target<must_not_have_aura>: .nook_morrow_1_quest_item }
	}

	entity thalvaron_north_yeti_boss: !NPC { _string: "Yeti Patriarch" _sprite: yeti_3 _sprite_dead: yeti_3_dead }
}

# Wandering owlbear
{
	loot_table .wandering_owlbear: 
	{
		slots:
		[	
			{ 
				possibility: { loot_group: .nook_morrow_2_quest_item_2 requirement self<must_have_active_quest>: { id: .nook_morrow_2 } } 
			}
			
			!WORLD_DROPS {}
		]	
	}
		
	${
		_level: 13
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short				
	}

	entity thalvaron_wandering_owlbear: !NPC { _string: "Wandering Owlbear" _sprite: owlbear_1 _sprite_dead: owlbear_1_dead _loot_table: .wandering_owlbear _weapon_damage: 2.5 _resource_health: 1.5 }
}

# Wolves
{
	${
		_level: 14
		_faction: monsters
		_creature_type: beast
		_default_behavior_state: .wandering_short				
		_loot_table: .default_beast
		_resource_health: 0.7
		_weapon_damage: 0.8
	}

	entity thalvaron_iceveil_wolf: !NPC { _string: "Iceveil Wolf" _sprite: wolf_1 _sprite_dead: wolf_1_dead }
}

# Frost Troll
{
	${
		_level: 14
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .passive				
		_loot_table: .default_humanoid 
		_weapon_damage: 1.5
		_resource_health: 1.8
		_aggro_requirements: { requirement target<must_not_be_type>: thalvaron_doctor_hulius }
	}

	entity thalvaron_frost_troll: !NPC { _string: "Frost Troll" _sprite: troll_2 _sprite_dead: troll_2_dead }
}

# Rock Elemental
{
	${
		_level: 14
		_faction: monsters
		_creature_type: elemental
		_default_behavior_state: .wandering_short
		_loot_table: .default_beast
		_weapon_damage: 1.1
		_resource_health: 1.1
	}

	entity thalvaron_rock_elemental: !NPC { _string: "Rock Elemental" _sprite: rock_elemental_1 _sprite_dead: rock_elemental_1_dead }
}

# Owlbear
{
	${
		_level: 14
		_faction: monsters
		_creature_type: beast
		_default_behavior_state: .wandering_short				
		_loot_table: .default_beast 
		_weapon_damage: 1.2 
		_resource_health: 1.3
	}

	entity thalvaron_owlbear: !NPC { _string: "Owlbear" _sprite: owlbear_2 _sprite_dead: owlbear_2_dead  }
}