dialogue_screen .brimiar_dialogue:
{
	text: 
	[	
		"Greetings, dear $class$."
	]		
	
	options:
	[
		{ quest<completion_only>: .pearly_b_1 }
		{ quest: .brimiar_1 }
		{ quest: .brimiar_2 }
	]
}

dialogue_root .brimiar_dialogue:
{
	.brimiar_dialogue: { }
}

entity thalvaron_brimiar: !NPC
{
	_string: "Brimiar"
	_dialogue_root: .brimiar_dialogue	
	_sprite: elf_6
	_sprite_dead: elf_6_dead
	_level: 20
	_faction: npcs		
	_creature_type: humanoid
	_loot_table: .npc
	_not_pushable: true	
}

############################################################
# Quest 1

loot_group .brimiar_1_quest_item: { }

item .brimiar_1_quest_item:
{
	binds: when_picked_up
	loot_groups: [ .brimiar_1_quest_item ]		
	string: "Brimiar's Book" 
	icon: icon_book
	item_level: 17
	quest: .brimiar_1
	flags: [ not_sellable unique ]
}

loot_table .brimiar_1_quest_item:
{
	slots:
	[
		{
			possibility: { loot_group: .brimiar_1_quest_item }			
		}		
	]
}
       
entity thalvaron_brimiar_1_quest_item:
{
	string: "Kobold Chest"
	systems: [ openable ]
	components:
	{
		position: { }		
		sprite: { animations: [ { states: [ default ] frames: [ chest_2 ] z_offset: -3 } ] }		

		openable: 
		{ 
			loot_table: .brimiar_1_quest_item
			verb: open
			range: 1 
			despawn: true 			
			level: 17
			required_quest: .brimiar_1
		}		
	}
}

objective .brimiar_1:
{
	string: "Brimiar's Book"

	collect_items: { item: .brimiar_1_quest_item count: 1 }
}

quest .brimiar_1:
{
	string: "Cave Burglary"

	text:
	[
		"Retrieve Brimiar's stolen book and return it to him."
	]
	
	description: 
	[
		"Last night someone broke into my home and stole one of my books off my table. I have no idea why anyone would steal it, but it's really annoying because I was in the middle of reading it.\n\n"
		"Maybe you can help me retrieve it? I can't offer you much clues about who could have done it, even though I woke up when it the burglars ran away. I heard a skitter-scatter of little feet as"
		"I turned on the light. Seemed like the ran off into the gorge to the east."
	]

	progress:
	[
		"Oh, also I think one of the burglars peed on my carpet. Had to throw it out."
	]
	
	completion:
	[
		"Excellent! Kobolds? Oh no, I don't want to deal with that again. I hope you got rid of a few of them."
	]

	objectives: [ .brimiar_1 ]
	level: 17	
	next_quest: .brimiar_2
	
	# FIXME: rewards
}

############################################################
# Quest 2

objective .brimiar_2:
{
	string: "Gorge Harpies Slain"
	
	maps: [ thalvaron ]
	
	kill_npc: { entities: [ thalvaron_gorge_harpy ] count: 8 }	
}

quest .brimiar_2:
{
	string: "Winged Terrors"

	text:
	[
		"Locate the harpy colony in the eastern gorge and thin out their numbers."
	]
	
	description: 
	[
		"I have other problems than thieving Kobolds that keep me up at night. Have you heard about harpies? A bunch of them are living in a colony a bit further to the east. I don't really care that much about them,"
		"but the problem is that they make an awful amount of noise after dark. I've lived by the sea before and I can tell you that they're worse than seagulls during breeding season! You might think that my home"
		"is deep enough underground to dampen most of the noise, but no, their constant screeching pierces right through the rocks. I don't know what's going on over there, but since you seem to be good at dealing with"
		"Kobolds, maybe you can deal with harpies too? Seek out their colony and thin out their numbers, please!"
	]

	progress:
	[
		"How is it going?"
	]
	
	completion:
	[
		"Ah yes, maybe I can finally sleep again. Thank you!"
	]

	objectives: [ .brimiar_2 ]
	level: 18
	prerequisites: [ .brimiar_1 ]
	
	# FIXME: rewards
}