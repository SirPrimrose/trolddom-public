npc_behavior_state .wandering_short:
{
	on_route<thalvaron_default_patrol>: thalvaron_default_patrol
	behavior: wandering
	max_range: 1
}

npc_behavior_state .passive:
{
	on_route<thalvaron_default_patrol>: thalvaron_default_patrol
	behavior: do_nothing
}

loot_table .default_humanoid: 
{
	slots:
	[	
		!WORLD_DROPS {}
		!WORLD_DROPS_CLOTH{}
	]	
}

loot_table .default_beast: 
{
	slots:
	[	
		!WORLD_DROPS {}
	]	
}

##########################################################################################
# Marshlands monsters

map_entity_spawn thalvaron_mud_slinger: 
{ 
	entity thalvaron_mud_slinger: { init_state: default } 
}

map_entity_spawn thalvaron_mud_slinger_2: 
{ 
	entity thalvaron_mud_slinger_2: { init_state: default } 
}

map_entity_spawn thalvaron_crocodile: 
{ 
	entity thalvaron_crocodile: { init_state: default level: 12 } 
	entity thalvaron_crocodile_2: { init_state: default level: 13 } 
	entity thalvaron_crocodile_3: { init_state: default level: 14 } 
}

map_entity_spawn thalvaron_crocodile_salt: 
{ 
	entity thalvaron_crocodile_salt: { init_state: default } 
}

map_entity_spawn thalvaron_swamp_monster: 
{ 
	entity thalvaron_swamp_lurker: { init_state: default } 
	entity thalvaron_swamp_dweller: { init_state: default } 
}

map_entity_spawn thalvaron_neutral_crab:
{
	entity thalvaron_neutral_crab: { init_state: default level: 13 } 
	entity thalvaron_neutral_crab_2: { init_state: default level: 14 } 
}

map_entity_spawn thalvaron_lizard_ambusher_1:
{
	spawn_timer: { only_when_triggered: true }
	spawn_timer: !NPC_RESPAWN_NORMAL{}
}

map_entity_spawn thalvaron_lizard_ambusher_2:
{
	spawn_timer: { only_when_triggered: true }
	spawn_timer: !NPC_RESPAWN_NORMAL{}
}

map_entity_spawn thalvaron_lizard_ambusher_3:
{
	spawn_timer: { only_when_triggered: true }
	spawn_timer: !NPC_RESPAWN_NORMAL{}
}

map_entity_spawn thalvaron_swamp_ooze:
{
	entity thalvaron_swamp_ooze: { init_state: default } 
}

# Neutral crabs
{

	${		
		_faction: wildlife
		_creature_type: beast
		_default_behavior_state: .wandering_short
		_loot_table: .default_beast
	}

	entity thalvaron_neutral_crab: !NPC { _string: "Marshlands Crab" _sprite: crab_1 _sprite_dead: crab_1_dead _level: 13 }
	entity thalvaron_neutral_crab_2: !NPC { _string: "Southern Mud Crawler" _sprite: crab_2 _sprite_dead: crab_2_dead _level: 14 }
}

# Mud slingers
{
	loot_table .mud_slinger: 
	{
		slots:
		[	
			{ 
				possibility: { weight: 1 }
				possibility: { weight: 1 loot_group: thalvaron_alchemy_trainer_1_quest_item requirement self<must_have_active_quest>: { id: thalvaron_alchemy_trainer_1 } } 
			}
			
			!WORLD_DROPS {}
		]	
	}
	
	${
		_level: 12
		_faction: monsters
		_creature_type: elemental		
		_loot_table: .mud_slinger
	}

	entity thalvaron_mud_slinger: !NPC { _string: "Mud Slinger" _sprite: swamp_monster_5 _sprite_dead: swamp_monster_5_dead _default_behavior_state: .wandering_short }
	entity thalvaron_mud_slinger_2: !NPC { _string: "Mudlord" _sprite: swamp_monster_4 _sprite_dead: swamp_monster_4_dead _default_behavior_state: .passive }
}

# Crocodiles
{
	loot_table .crocodile: 
	{
		slots:
		[	
			{ 
				possibility: { weight: 1 }
				possibility: { weight: 1 loot_group: .swampman_1_quest_item requirement self<must_have_active_quest>: { id: .swampman_1 } } 
			}
			
			!WORLD_DROPS {}
		]	
	}
	
	loot_table .crocodile_salt: 
	{
		slots:
		[	
			{ 
				possibility: { weight: 1 }
				possibility: { weight: 1 loot_group: .swampman_1_quest_item requirement self<must_have_active_quest>: { id: .swampman_1 } } 
			}

			{ 
				possibility: { loot_group: .gob_fulbro_1_quest_item requirement self<must_have_active_quest>: { id: .gob_fulbro_1 } } 
			}

			!WORLD_DROPS {}
		]	
	}	
	
	${		
		_faction: monsters
		_creature_type: beast				
		_can_move_on_all_non_view_blocking_tiles: true
	}

	entity thalvaron_crocodile: !NPC { _level: 12 _string: "Marshlands Crocodile" _sprite: crocodile_2 _sprite_dead: crocodile_2_dead _in_water_sprite: crocodile_2_submerged _default_behavior_state: .passive _loot_table: .crocodile }
	entity thalvaron_crocodile_2: !NPC { _level: 13 _string: "Swamp Crocodile" _sprite: crocodile_2 _sprite_dead: crocodile_2_dead _in_water_sprite: crocodile_2_submerged _default_behavior_state: .passive _loot_table: .crocodile }
	entity thalvaron_crocodile_3: !NPC { _level: 14 _string: "Ravenous Crocodile" _sprite: crocodile_2 _sprite_dead: crocodile_2_dead _in_water_sprite: crocodile_2_submerged _default_behavior_state: .passive _loot_table: .crocodile }
	entity thalvaron_crocodile_salt: !NPC { _level: 13 _string: "Salty" _sprite: crocodile_1 _sprite_dead: crocodile_1_dead _in_water_sprite: crocodile_1_submerged _default_behavior_state: .passive _loot_table: .crocodile_salt }
}

# Swamp monsters
{
	${
		_level: 12
		_faction: monsters
		_creature_type: elemental
		_loot_table: .default_beast
		_default_behavior_state: .wandering_short
	}

	entity thalvaron_swamp_lurker: !NPC { _string: "Swamp Lurker" _sprite: swamp_monster_2 _sprite_dead: swamp_monster_2_dead }
	entity thalvaron_swamp_dweller: !NPC { _string: "Swamp Dweller" _sprite: swamp_monster_3 _sprite_dead: swamp_monster_3_dead }
}

# Lizard ambushers in mine
{
	${
		_level: 13
		_faction: monsters
		_creature_type: beast
		_loot_table: .default_beast
	}

	entity thalvaron_lizard_ambusher: !NPC { _string: "Cave Lizard" _sprite: lizard_1 _sprite_dead: lizard_1_dead }
}

# Oozes for farm quest
{
	${
		_level: 14
		_faction: monsters
		_creature_type: elemental
		_loot_table: .default_beast
		_default_behavior_state: .passive
	}

	entity thalvaron_swamp_ooze: !NPC { _string: "Putrid Ooze" _sprite: ooze_1 _sprite_dead: ooze_2_dead }
}

##########################################################################################
# North Marshlands kobolds

map_entity_spawn thalvaron_north_marshlands_kobold: 
{ 
	entity thalvaron_north_marshlands_kobold_a: { init_state: default } 
	entity thalvaron_north_marshlands_kobold_b: { init_state: default } 
	entity thalvaron_north_marshlands_kobold_c: { init_state: default } 
}

map_entity_spawn thalvaron_north_marshlands_kobold_boss: 
{ 
	entity thalvaron_north_marshlands_kobold_boss: { init_state: default } 
}

# Melee
{

	${
		_level: 12
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short
		_loot_table: .default_humanoid
		_weapon_damage: 0.9
		_resource_health: 0.8
	}

	entity thalvaron_north_marshlands_kobold_a: !NPC { _string: "Mountain Kobold" _sprite: kobold_3 _sprite_dead: kobold_3_dead }
	entity thalvaron_north_marshlands_kobold_b: !NPC { _string: "Mountain Kobold" _sprite: kobold_4 _sprite_dead: kobold_4_dead }
}

# Healer
{

	${
		_level: 12
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short
		_loot_table: .default_humanoid
		_weapon_damage: 0.9
		_resource_health: 0.8
		_resource_mana: 1
		_abilities: 
		[ 
			{ id: npc_heal target: low_health_friend_or_self }
			{ id: npc_firebolt }
			{ id: npc_attack } 
		]		
	}

	entity thalvaron_north_marshlands_kobold_c: !NPC { _string: "Kobold Soothsayer" _sprite: kobold_5 _sprite_dead: kobold_5_dead }
}

# Boss
{

	loot_table .north_marshlands_kobold_boss: 
	{
		slots:
		[	
			{ 
				possibility: { loot_group: .north_marshlands_kobold_boss } 
			}
			
			!WORLD_DROPS {}
		]	
	}
	
	loot_group .north_marshlands_kobold_boss: { }
	
	ability .north_marshlands_kobold_boss:	
	{
		string: "City Guard Helmet"
		description: "This item starts a quest."
		flags: [ target_self item ]
		icon: icon_head_4
		direct_effect simple<start_quest>: thalvaron_north_marshlands_kobold_boss
		states: [ default in_combat ]
		requirement self<must_not_have_completed_quest>: { id: thalvaron_north_marshlands_kobold_boss }
		requirement self<must_not_have_active_quest>: { id: thalvaron_north_marshlands_kobold_boss }
	}

	item .north_marshlands_kobold_boss:
	{
		loot_groups: [ .north_marshlands_kobold_boss ]		
		string: "City Guard Helmet" 
		flavor: "Smells like kobold."
		icon: icon_head_4
		item_level: 12
		flags: [ unique not_sellable ]
		use_ability: .north_marshlands_kobold_boss
	}	
			
	quest thalvaron_north_marshlands_kobold_boss:
	{
		string: "City Guard Helmet"

		text:
		[
			"Bring the city guard helmet back to Lieutenant Tusleholm."
		]
		
		description: 
		[
			"This, slightly bigger than usual, kobold wore a helmet apparently stolen from the city guard. Might be of interest to Lieutenant Tusleholm."
		]
		
		completion:
		[
			"Nothing unusual about kobolds stealing shiny things. What's more interesting, is how the cave led into something that sounds like an old abandoned underground fortress."
		]

		level: 12
		quest_items: [ .north_marshlands_kobold_boss ]
		reward_xp_multiplier: 0.2
	}

	${
		_level: 12
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .wandering_short
		_loot_table: .north_marshlands_kobold_boss
		_weapon_damage: 1.1
		_resource_health: 1.7
	}

	entity thalvaron_north_marshlands_kobold_boss: !NPC { _string: "Kobold Shift Boss" _sprite: kobold_6 _sprite_dead: kobold_6_dead }
}

##########################################################################################
# Mongo the ogre

map_entity_spawn thalvaron_mongo: 
{ 
	entity thalvaron_mongo: { init_state: default } 
}

# Melee
{

	${
		_level: 18
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .passive
		_loot_table: .default_humanoid
		_weapon_damage: 1.1
		_resource_health: 6
		_elite: true
	}

	entity thalvaron_mongo: !NPC { _string: "Mongo" _sprite: ogre_1 _sprite_dead: ogre_1_dead }
}

##########################################################################################
# Bandits

map_entity_spawn thalvaron_marsh_bandit: 
{ 
	entity thalvaron_marsh_bandit_a: { init_state: default } 
	entity thalvaron_marsh_bandit_b: { init_state: default } 
	entity thalvaron_marsh_bandit_c: { init_state: default } 
	entity thalvaron_marsh_bandit_d: { init_state: default } 
}

# Bandits
{
	${
		_level: 13
		_faction: monsters
		_creature_type: humanoid
		_default_behavior_state: .passive
		_loot_table: .default_humanoid
	}

	entity thalvaron_marsh_bandit_a: !NPC { _string: "Marsh Bandit" _sprite: rebel_1 _sprite_dead: rebel_1_dead }
	entity thalvaron_marsh_bandit_b: !NPC { _string: "Marsh Bandit" _sprite: rebel_2 _sprite_dead: rebel_2_dead }
	entity thalvaron_marsh_bandit_c: !NPC { _string: "Marsh Bandit" _sprite: rebel_3 _sprite_dead: rebel_3_dead }
	entity thalvaron_marsh_bandit_d: !NPC { _string: "Marsh Bandit" _sprite: rebel_4 _sprite_dead: rebel_4_dead _abilities: [ { id: npc_shoot }{ id: npc_attack } ] }
}
