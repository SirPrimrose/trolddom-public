map_player_spawn test_dungeon_player_spawn_2:
{
}

map_portal test_dungeon_exit_2:
{
	map: test_world
	spawn: test_world_dungeon_exit_2
}

map_segment_connector connector_east: { connects: [ connector_west ] }
map_segment_connector connector_west: { connects: [ connector_east ] }
map_segment_connector connector_south: { connects: [ connector_north ] }
map_segment_connector connector_north: { connects: [ connector_south ] }

!define local DUNGEON_PALETTE
[
	{ symbol: "." tiles: [ dungeon_floor ] }			
	{ symbol: "W" tiles: [ dungeon_wall ] }
	
	{ 
		symbol: "e" 
		tiles: [ dungeon_wall_face_exit ] 
		portals: [ test_dungeon_exit_2 ] 
	}
	
	{ 
		symbol: "i" 
		tiles: [ dungeon_floor ] 
		player_spawns: [ test_dungeon_player_spawn_2 ] 
	}		

	{ 
		symbol: "1" 
		tiles: [ dungeon_floor ] 
		connectors: [ connector_east ]
	}				
	
	{ 
		symbol: "2" 
		tiles: [ dungeon_floor ] 
		connectors: [ connector_west ]
	}				
	
	{ 
		symbol: "3" 
		tiles: [ dungeon_floor ] 
		connectors: [ connector_south ]
	}					
	
	{ 
		symbol: "4" 
		tiles: [ dungeon_floor ] 
		connectors: [ connector_north ]
	}						
]

!define local DUNGEON_WALL_FACE_MODIFIER
{
	walls: [ dungeon_wall ]
	floors: [ dungeon_floor ]
	faces: [ dungeon_wall_face ]
}

map_segment dungeon_random_room_1<random_room>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	random_room:
	{
		wall_tiles: [ dungeon_wall ]
		floor_tiles: [ dungeon_floor ]
	
		rect_count: [ 1 4 ]
		rect_width: [ 4 10 ]
		rect_height: [ 4 10 ]
		
		connector connector_east: { direction: east size: 1 }
		connector connector_west: { direction: west size: 1 }
		connector connector_north: { direction: north size: 1 }
		connector connector_south: { direction: south size: 1 }
		
		connector_count: [ 1 4 ]		
	}
}

map_segment dungeon_entrance_1<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}		
	paletted_map:
	[
		"WWWWW "
		"WWeWW "
		"W.i.W "
		"W...W "
		"W....1"
		"WWWWW "
	]		
}

map_segment dungeon_entrance_2<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}		
	paletted_map:
	[
		"WWWWW"
		"WWeWW"
		"W.i.W"
		"W...W"
		"2...W"
		"WWWWW"
	]		
}

map_segment dungeon_passage_1<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}		
	paletted_map:
	[
		"WWWWW "
		"W...W "
		"2....1"
		"W...W "
		"WWWWW "
	]	
}

map_segment dungeon_passage_2<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WWWWWWWWW "
		"W.......W "
		"2.......W "
		"W.......W "
		"WWWWW...W "
		"    W...W "
		"    W...W "
		"    W....1"
		"    WWWWW "
	]	
}

map_segment dungeon_passage_3<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}		
	paletted_map:
	[
		"WWWWW "
		"W...W "
		"2....1"
		"W...W "
		"WW.WW "
		"  3   "
	]	
}

map_segment dungeon_passage_4<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WW4WWWWWW "
		"W.......W "
		"W.......W "
		"W.......W "
		"WWWWW...W "
		"    W...W "
		"    W...W "
		"    W...W "
		"    WW.WW "
		"      3   "
	]	
}

map_segment dungeon_blind_1<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WWWWW"
		"W...W"
		"2...W"
		"W...W"
		"WWWWW"
	]	
}

map_segment dungeon_blind_2<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WWWWW "
		"W...W " 
		"W....1"
		"W...W "
		"WWWWW "
	]	
}

map_segment dungeon_blind_3<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WW4WW"
		"W...W"
		"W...W"
		"W...W"
		"WWWWW"
	]	
}

map_segment dungeon_blind_4<paletted>:
{
	tile_map_modifier wall_face: !DUNGEON_WALL_FACE_MODIFIER {}
	palette: !DUNGEON_PALETTE {}				
	paletted_map:
	[
		"WWWWW"
		"W...W" 
		"W...W"
		"W...W"
		"WW.WW"
		"  3  "
	]	
}

map test_dungeon_2:
{
	string: "Test Dungeon 2"
	type: private
	reset: manual
	default_tile: dungeon_wall
	default_player_spawn: test_dungeon_player_spawn_2
	default_exit_portal: test_dungeon_exit_2
	view_attenuation: 30
	view_attenuation_bias: 50
	view_hidden_visibility: 0
	seed: random

	generator dungeon:
	{	
		room entrance:
		{
			flags: [ root ]
			segment<1>: dungeon_entrance_1
			segment<1>: dungeon_entrance_2
			
			connection passage<connector_east>: { weight: 1 debug_name: "A" }
			connection passage<connector_west>: { weight: 1 debug_name: "B" }
		}
		
		room passage:
		{
			segment<1>: dungeon_passage_1
			segment<1>: dungeon_passage_2
			segment<1>: dungeon_passage_3
			segment<1>: dungeon_passage_4
			segment<3>: dungeon_random_room_1
			
			connection passage<connector_east>: { weight: 1 debug_name: "C" }
			connection blind<connector_east>: { weight: 1 debug_name: "D" }

			connection passage<connector_west>: { weight: 1 debug_name: "E" }
			connection blind<connector_west>: { weight: 1 debug_name: "F" }
			
			connection passage<connector_north>: { weight: 1 debug_name: "G" }
			connection blind<connector_north>: { weight: 1 debug_name: "H" }			
			
			connection passage<connector_south>: { weight: 1 debug_name: "I" }
			connection blind<connector_south>: { weight: 1 debug_name: "J" }						
		}		
		
		room blind:
		{
			segment<1>: dungeon_blind_1
			segment<1>: dungeon_blind_2
			segment<1>: dungeon_blind_3
			segment<1>: dungeon_blind_4
		}				
	}
}
 